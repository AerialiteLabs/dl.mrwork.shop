---
import Sidebar from "../../components/Sidebar.astro";
import releaseData from '../../data/sh1mmer.json';
import { format } from 'date-fns';
import { AstroFont } from "astro-font";

const releasename = releaseData.name.replace(/v.*$/, "").trim();

const assets = releaseData.assets.map(asset => ({
  name: asset.name,
  url: asset.browser_download_url,
  date: asset.updated_at 
    ? format(new Date(asset.updated_at), "yyyy-MM-dd") 
    : "Unknown",
  size: `${(asset.size / 1024 / 1024).toFixed(2)} MB`
}));
---


<html lang="en">
  <head>
    <meta charset="utf-8">
	<meta property="og:title" content={`${releasename} - Mr. Workshop's Download Server`}>
	<meta property="og:description" content="If they gave a prize for best downloads the winner would be him">
	<meta property="og:image" content="/preview.png">
	<meta property="og:url" content="https://dl.mrwork.shop/">
    <link rel="icon" type="image/png" href="/download.png">
    <link rel="stylesheet" href="/style.css">
    <meta name="viewport" content="width=device-width">
    <meta name="generator" content={Astro.generator}>
    <AstroFont
		config={[
			{
				name: "Terminus",
				src: [
					{
						weight: "400",
						style: "normal",
						path: "/Terminus.woff2"
					}
				],
				preload: true,
				display: "swap",
				selector: "body",
				fallback: "monospace",
			},
			{
				name: "Roboto Mono",
				src: [
					{
						weight: "400",
						style: "normal",
						path: "https://cdnjs.cloudflare.com/ajax/libs/uswds/3.13.0/fonts/roboto-mono/roboto-mono-v5-latin-regular.woff2"
					},
					{
						weight: "700",
						style: "normal",
						path: "https://cdnjs.cloudflare.com/ajax/libs/uswds/3.13.0/fonts/roboto-mono/roboto-mono-v5-latin-700.woff2"
					}
				],
				preload: true,
				display: "swap",
				fallback: "monospace",
			}
		]}
	/>
    <title>{releasename} - Mr. Workshop's Download Server</title>
  </head>
  <body>
	<div class="navbar">
	<button class="nav" id="nav"><span></span><span></span><span></span></button>
	</div>

	<div class="overlay" id="overlay">
	<Sidebar/>
	</div>

	<script>
	const nav = document.getElementById("nav");
	const overlay = document.getElementById("overlay");

	function closeOverlay() {
		overlay!.classList.remove("active");
		nav!.classList.remove("active");
	}

	nav!.addEventListener("click", () => {
		overlay!.classList.toggle("active");
		nav!.classList.toggle("active");
	});

	overlay!.addEventListener("click", (e) => {
		if (e.target === overlay) closeOverlay();
	});

	document.addEventListener("keydown", (e) => {
		if (e.key === "Escape") closeOverlay();
	});
	</script>
    <h1>{releasename} - Mr. Workshop's Download Server</h1>
    <div class="main">
		<a class="file" href="/"><span class="filename">../</span></a>
		{assets.map(asset => (
		<a class="file" id="file" data-name={asset.name} href={asset.name}><span class="filename">{asset.name}</span><span class="date">{asset.date}</span><span class="size">{asset.size}</span></a>
		))}

    </div>
  </body>
</html>
